package org.folio.cataloging.dao.persistence;

import net.sf.hibernate.CallbackException;
import net.sf.hibernate.Session;
import org.folio.cataloging.business.common.DataAccessException;
import org.folio.cataloging.business.common.PersistenceState;
import org.folio.cataloging.business.common.PersistentObjectWithView;
import org.folio.cataloging.business.common.UserViewHelper;
import org.folio.cataloging.dao.AbstractDAO;
import org.folio.cataloging.dao.DAODescriptor;
import org.folio.cataloging.dao.DAOPublTag;
import org.folio.cataloging.dao.PublisherDescriptorDAO;
import org.folio.cataloging.log.Log;
import org.folio.cataloging.util.StringText;

import java.io.Serializable;

/**
 * Descriptor class for PUBL_TAG.
 *
 * @since 1.0
 */
public class PUBL_TAG implements PersistentObjectWithView {

	public String toString() {
		return "PUBL_TAG(" + getPublisherTagNumber() + ", "
				+ getUserViewString() + ", " + getPublisherHeadingNumber()
				+ ", " + getSequenceNumber() + ", " + getOtherSubfields() + ")";
	}

	private static final long serialVersionUID = 1L;

  private static Log logger = new Log(PUBL_TAG.class);

	private int publisherTagNumber = -1;
	private PersistenceState persistence = new PersistenceState();
	private UserViewHelper uvh = new UserViewHelper();
	private int sequenceNumber;
	private PUBL_HDG descriptor = new PUBL_HDG();
	private String otherSubfields;
	private Integer publisherHeadingNumber;
	private final DAOPublTag theDAO = new DAOPublTag();
	private final DAODescriptor thePublisherDescriptor = new PublisherDescriptorDAO();

	public void evict() throws DataAccessException {
		evict(this);
	}

	public DAODescriptor getDescriptorDAO() {
		return thePublisherDescriptor;
	}

	public void generateNewKey() throws DataAccessException {
		logger.error("PUBL_TAG keys are generated by the owning PublisherTagDescriptor");
		throw new IllegalArgumentException();
	}

  /**
   *
   * @return descriptor stringText
   */
	public String getStringText() {
	  final StringBuilder builder = new StringBuilder();
	  builder.append(new StringText(getOtherSubfields()).getSubfieldsWithCodes("368").toString())
      .append((getDescriptor() != null) ?getDescriptor().getStringText() :"")
      .append(new StringText(getOtherSubfields()).getSubfieldsWithoutCodes("368").toString());

		return builder.toString();
	}

 	public boolean equals(Object arg0) {
		if (arg0 instanceof PUBL_TAG) {
			PUBL_TAG obj = (PUBL_TAG) arg0;
			return this.getPublisherTagNumber() == obj.getPublisherTagNumber()
					&& this.getUserViewString().equals(obj.getUserViewString())
					&& this.getSequenceNumber() == obj.getSequenceNumber();
		}
		return false;
	}

	public AbstractDAO getDAO() {
		return theDAO;
	}

	/**
	 * @return the content of subfield c.
	 *
	 * @since 1.0
	 */
	public String getDate() {
		return new StringText(getOtherSubfields()).getSubfieldsWithCodes("c").toDisplayString();
	}

	public PUBL_HDG getDescriptor() {
		return descriptor;
	}

	public String getOtherSubfields() {
		return otherSubfields;
	}

	public Integer getPublisherHeadingNumber() {
		return publisherHeadingNumber;
	}

	public int getSequenceNumber() {
		return sequenceNumber;
	}

	public int hashCode() {
		return getPublisherTagNumber() * getSequenceNumber();
	}

	public void setDescriptor(final PUBL_HDG heading) {
		this.descriptor = heading;
		if (heading != null) {
			setPublisherHeadingNumber(new Integer(heading.getHeadingNumber()));
		}
	}

  /**
   *
   * @param stringText
   */
	public void setStringText(String stringText) {
		StringText s = new StringText(stringText);
		getDescriptor().setStringText(s.getSubfieldsWithoutCodes("cefg").toString());
		setOtherSubfields(s.getSubfieldsWithCodes("cefg").toString());
	}

	public void setOtherSubfields(final String otherSubfields) {
		this.otherSubfields = otherSubfields;
	}

	public void setPublisherHeadingNumber(final Integer publisherHeadingNumber) {
		this.publisherHeadingNumber = publisherHeadingNumber;
	}

	public void setSequenceNumber(final int sequenceNumber) {
		this.sequenceNumber = sequenceNumber;
	}

	public void evict(Object obj) throws DataAccessException {
		persistence.evict(obj);
	}

	public int getUpdateStatus() {
		return persistence.getUpdateStatus();
	}

	public boolean isChanged() {
		return persistence.isChanged();
	}

	public boolean isDeleted() {
		return persistence.isDeleted();
	}

	public boolean isNew() {
		return persistence.isNew();
	}

	public boolean isRemoved() {
		return persistence.isRemoved();
	}

	public void markChanged() {
		persistence.markChanged();
	}

	public void markDeleted() {
		persistence.markDeleted();
	}

	public void markNew() {
		persistence.markNew();
	}

	public void markUnchanged() {
		persistence.markUnchanged();
	}

	public boolean onDelete(Session arg0) throws CallbackException {
		return persistence.onDelete(arg0);
	}

	public void onLoad(Session arg0, Serializable arg1) {
		persistence.onLoad(arg0, arg1);
	}

	public boolean onSave(Session arg0) throws CallbackException {
		return persistence.onSave(arg0);
	}

	public boolean onUpdate(Session arg0) throws CallbackException {
		return persistence.onUpdate(arg0);
	}

	public void setUpdateStatus(int i) {
		persistence.setUpdateStatus(i);
	}

	public String getUserViewString() {
		return uvh.getUserViewString();
	}

	public void setUserViewString(String string) {
		uvh.setUserViewString(string);
	}

	public int getPublisherTagNumber() {
		return publisherTagNumber;
	}

	public void setPublisherTagNumber(int publisherTagNumber) {
		this.publisherTagNumber = publisherTagNumber;
	}

}
